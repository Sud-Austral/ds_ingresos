---
title: Tablas de contingencia sobre ingresos, frecuencias y variables sobre las<span style="color:green"> Casen 2006-2020 </span>
author:
- name: VE-CC-AJ
  affiliation: DataIntelligence
subtitle: | 
  Por comunas
header-includes:
   - \usepackage[]{babel}
output:
  rmdformats::html_clean:
    highlight: kate
    toc: true
    use_bookdown: true
    code_folding: "hide"    
---

date: `r format(Sys.time(), "%d-%m-%Y")`
<style type="text/css">
.main-container {
  max-width: 1600px;
  margin-left: 100px;
  margin-right: auto;
}
</style>
 


# Las variables de ingreso a utilizar serán:

 |**Tipo**| | | 
:-----:|:-----:|:-----:|:-----:|:-----:
 |  |Ingreso total|Ingreso autónomo|Ingreso del trabajo
año| | |
2017|ytotcor|yautcor|ytrabajocor
2015|ytotcor|yautcor|ytrabajocor
2013|ytotcor|yautcor|ytrabajocor
2011|ytrabaj |yautaj |ytrabaj
2009|ytrabaj |yautaj |ytrabaj
2006|ytrabaj |yautaj |ytrabaj

</br>


```{r , message=FALSE, warning=FALSE, include = FALSE, eecho = FALSE}

#suppressWarnings(library(RODBC))

library(ggplot2)
library(ggpubr)
library(markdown)
library(shiny)
library(shinythemes)
library(tidyverse)
library(magrittr)
library(lubridate)
library(plotly)
library(xts)
library(dygraphs)
library(kableExtra)
library(knitr)
library("readxl")
library(rsconnect)
library(dplyr)
library(summarytools)
library(epiDisplay)
#library(leaflet)
library(haven)
library(epiDisplay)
library("readxl")
library(expss)
library(hrbrthemes)
library(viridis)
library(viridisLite)
library(DescTools)
library(roperators)
library(shinycssloaders)
library(writexl)
library(labelled)
library(tidyverse)
library(haven)
library(readr)
library(sjmisc)
library(WriteXLS)

library(ineq)
library(readstata13)
library(reldist)

library(DT)
```


## Lectura de bases de datos Casen

```{r, message=FALSE, warning=FALSE}
dataset_06 <<- readRDS("C:/Users/enamo/Desktop/Shiny-R/Casen_en_pandemia_2020/casen/casen_2006_c.rds")
dataset_06 <- mutate_if(dataset_06, is.factor, as.character)
dataset_09 <<- readRDS("C:/Users/enamo/Desktop/Shiny-R/Casen_en_pandemia_2020/casen/casen_2009_c.rds")
dataset_09 <- mutate_if(dataset_09, is.factor, as.character)
dataset_11 <<- readRDS("C:/Users/enamo/Desktop/Shiny-R/Casen_en_pandemia_2020/casen/casen_2011_c.rds")
dataset_11 <- mutate_if(dataset_11, is.factor, as.character)
dataset_13 <<- readRDS("C:/Users/enamo/Desktop/Shiny-R/Casen_en_pandemia_2020/casen/casen_2013_c.rds")
dataset_13 <- mutate_if(dataset_13, is.factor, as.character)
dataset_15 <<- readRDS("C:/Users/enamo/Desktop/Shiny-R/Casen_en_pandemia_2020/casen/casen_2015_c.rds")
dataset_15 <- mutate_if(dataset_15, is.factor, as.character)
dataset_17 <<- readRDS("C:/Users/enamo/Desktop/Shiny-R/Casen_en_pandemia_2020/casen/casen_2017_c.rds")
dataset_17 <- mutate_if(dataset_17, is.factor, as.character)
dataset_20 <<- readRDS("C:/Users/enamo/Desktop/Shiny-R/Casen_en_pandemia_2020/casen/casen_2020.rds")
dataset_20 <- mutate_if(dataset_20, is.factor, as.character)
```

### Homologación de alfabetismo

```{r, message=FALSE, warning=FALSE}

dataset_06$E1[dataset_06$E1 == "No sabe /Sin dato"] <- NA

dataset_11$e1[dataset_11$e1 == "Sí, lee y escribe"] <- "Sí"
dataset_11$e1[dataset_11$e1 == "No, sólo lee"] <- "No"
dataset_11$e1[dataset_11$e1 == "No, ninguno"] <- "No"
dataset_11$e1[dataset_11$e1 == "No, sólo escribe"] <- "No"

dataset_13$e1[dataset_13$e1 == "Sí, lee y escribe"] <- "Sí"
dataset_13$e1[dataset_13$e1 == "No, ninguno"] <- "No"
dataset_13$e1[dataset_13$e1 == "No, sólo lee"] <- "No"
dataset_13$e1[dataset_13$e1 == "No, sólo escribe"] <- "No"
dataset_13$e1[dataset_13$e1 == "NS/NR"] <- NA

dataset_15$e1[dataset_15$e1 == "Sí, lee y escribe"] <- "Sí"
dataset_15$e1[dataset_15$e1 == "No, ninguno"] <- "No"
dataset_15$e1[dataset_15$e1 == "No, sólo lee"] <- "No"
dataset_15$e1[dataset_15$e1 == "No, sólo escribe"] <- "No"

dataset_17$e1[dataset_17$e1 == "Sí, lee y escribe"] <- "Sí"
dataset_17$e1[dataset_17$e1 == "No, sólo lee"] <- "No"
dataset_17$e1[dataset_17$e1 == "No, ninguno"] <- "No"
dataset_17$e1[dataset_17$e1 == "No sabe/responde"] <- NA
dataset_17$e1[dataset_17$e1 == "No, sólo escribe"] <- "No"

```


<!-- # ```{r} -->
<!-- # length(unique(dataset_06$S1)) -->
<!-- # length(unique(dataset_09$S1)) -->
<!-- # length(unique(dataset_11$s17)) -->
<!-- # length(unique(dataset_13$s14)) -->
<!-- # length(unique(dataset_15$s12)) -->
<!-- # length(unique(dataset_17$s12)) -->
<!-- # length(unique(dataset_20$s13)) -->
<!-- # ``` -->

### Homologación de **s13** ¿A qué sistema previsional de salud pertenece usted? 

```{r}
dataset_06$S1[dataset_06$S1 == "Sistema Público grupo A"] <- "Público"
dataset_06$S1[dataset_06$S1 == "Sistema Público grupo B"] <- "Público"
dataset_06$S1[dataset_06$S1 == "Sistema Público grupo C"] <- "Público"
dataset_06$S1[dataset_06$S1 == "Sistema Público grupo D"] <- "Público"
dataset_06$S1[dataset_06$S1 == "Otro Sistema"] <- "Otro"
dataset_06$S1[dataset_06$S1 == "F.F.A.A. y del orden"] <- "FF.AA."
dataset_06$S1[dataset_06$S1 == "Ninguno (particular)"] <- "Ninguno"
dataset_06$S1[dataset_06$S1 == "Sistema Público no sabe grupo"] <- "No sabe"

dataset_09$S1[dataset_09$S1 == "Sistema Público grupo A"] <- "Público"
dataset_09$S1[dataset_09$S1 == "Sistema Público grupo B"] <- "Público"
dataset_09$S1[dataset_09$S1 == "Sistema Público grupo C"] <- "Público"
dataset_09$S1[dataset_09$S1 == "Sistema Público grupo D"] <- "Público"
dataset_09$S1[dataset_09$S1 == "Otro Sistema. Especifique"] <- "Otro"
dataset_09$S1[dataset_09$S1 == "F.F.A.A. y del orden"] <- "FF.AA."
dataset_09$S1[dataset_09$S1 == "Ninguno (particular)"] <- "Ninguno"
dataset_09$S1[dataset_09$S1 == "Sistema Público no sabe grupo"] <- "No sabe"

dataset_11$s17[dataset_11$s17 == "S. Público FONASA Grupo A"] <- "Público"
dataset_11$s17[dataset_11$s17 == "S. Público FONASA Grupo B"] <- "Público"
dataset_11$s17[dataset_11$s17 == "S. Público FONASA Grupo C"] <- "Público"
dataset_11$s17[dataset_11$s17 == "S. Público FONASA Grupo D"] <- "Público"
dataset_11$s17[dataset_11$s17 == "Otro sistema"] <- "Otro"
dataset_11$s17[dataset_11$s17 == "F.F.A.A. y del Orden"] <- "FF.AA."
dataset_11$s17[dataset_11$s17 == "Ninguno (particular)"] <- "Ninguno"
dataset_11$s17[dataset_11$s17 == "S. Público FONASA No sabe grupo"] <- "No sabe"

dataset_13$s14[dataset_13$s14 == "S. Público FONASA Grupo A"] <- "Público"
dataset_13$s14[dataset_13$s14 == "S. Público FONASA Grupo B"] <- "Público"
dataset_13$s14[dataset_13$s14 == "S. Público FONASA Grupo C"] <- "Público"
dataset_13$s14[dataset_13$s14 == "S. Público FONASA Grupo D"] <- "Público" 
dataset_13$s14[dataset_13$s14 == "Otro sistema"] <- "Otro" 
dataset_13$s14[dataset_13$s14 == "FF.AA. y del Orden"] <- "FF.AA."
dataset_13$s14[dataset_13$s14 == "Ninguno (particular)"] <- "Ninguno"
dataset_13$s14[dataset_13$s14 == "S. Público FONASA No sabe grupo"] <- "No sabe"

dataset_15$s12[dataset_15$s12 == "Sistema Público FONASA grupo A"] <- "Público"
dataset_15$s12[dataset_15$s12 == "Sistema Público FONASA grupo B"] <- "Público"
dataset_15$s12[dataset_15$s12 == "Sistema Público FONASA grupo C"] <- "Público"
dataset_15$s12[dataset_15$s12 == "Sistema Público FONASA grupo D"] <- "Público" 
dataset_15$s12[dataset_15$s12 == "Otro sistema"] <- "Otro" 
dataset_15$s12[dataset_15$s12 == "FF.AA. y del Orden"] <- "FF.AA."
dataset_15$s12[dataset_15$s12 == "Ninguno (particular)"] <- "Ninguno"
dataset_15$s12[dataset_15$s12 == "Sistema Público FONASA No sabe grupo"] <- "No sabe"

dataset_17$s12[dataset_17$s12 == "Sistema Público FONASA Grupo A"] <- "Público"
dataset_17$s12[dataset_17$s12 == "Sistema Público FONASA Grupo B"] <- "Público"
dataset_17$s12[dataset_17$s12 == "Sistema Público FONASA Grupo C"] <- "Público"
dataset_17$s12[dataset_17$s12 == "Sistema Público FONASA Grupo D"] <- "Público" 
dataset_17$s12[dataset_17$s12 == "Otro sistema"] <- "Otro" 
dataset_17$s12[dataset_17$s12 == "FF.AA. y de Orden"] <- "FF.AA."
dataset_17$s12[dataset_17$s12 == "Ninguno (Particular)"] <- "Ninguno"
dataset_17$s12[dataset_17$s12 == "Sistema Público FONASA No sabe grupo"] <- "No sabe"
 
dataset_20$s13[dataset_20$s13 == "Ninguno (particular)"] <- "Ninguno"
dataset_20$s13[dataset_20$s13 == "Sistema Público FONASA"] <- "Público"
dataset_20$s13[dataset_20$s13 == "Otro sistema"] <- "Otro" 
dataset_20$s13[dataset_20$s13 == "FF.AA. y del Orden"] <- "FF.AA." 

```

# Generación de tablas de contingencia 

```{r, message=FALSE, warning=FALSE}

df_tablas <- data.frame()

for (var2 in 1:3) {


for (var1 in 1:5) {
funcion1 <- function(n){

  comunales<-switch(n,"codigos_comunales_2006.rds","codigos_comunales_2009.rds","codigos_comunales_2011-2017.rds","codigos_comunales_2011-2017.rds","codigos_comunales_2011-2017.rds","codigos_comunales_2011-2017.rds","codigos_comunales_2011-2017.rds")
 xx<-switch(n,"2006","2009","2011","2013","2015","2017","2020")
 tanio <<- xx

 switch (var1,
        case = v1 <- switch(n,"S1","S1","s17","s14","s12","s12","s13"),
        case = v1 <- switch(n,"O1","O1","o1","o1","o1","o1","o1"),
        case = v1 <- switch(n,"O2","O2","o2","o2","o2","o2","o2"),
        case = v1 <- switch(n,"O3","O3","o3","o3","o3","o3","o3"),
        case = v1 <- switch(n,"O4","O4","o6","o6","o6","o6","o6")
)
 

if(xx==2006) {
  
  ingreso <- switch(var2,"YTOTAJ","YAUTAJ","YTRABAJ","YOPRAJ") 
eliminated <- dataset_06[!is.na(dataset_06[,c(ingreso)]),]
a <- eliminated[,c(ingreso)]
b <- eliminated$COMUNA
c <- eliminated[,c(v1)]
d <- eliminated$E1 #alfabetismo
e <- eliminated$T4 #etnia
f <- eliminated$SEXO
anio <- 2006
}

if(xx==2009) {

  ingreso <- switch(var2,"YTOTAJ","YAUTAJ","YTRABAJ","YOPRAJ") 
eliminated <- dataset_09[!is.na(dataset_09[,c(ingreso)]),]
a <- eliminated[,c(ingreso)]
b <- eliminated$COMUNA
c <- eliminated[,c(v1)]
d <- eliminated$E1 #alfabetismo
e <- eliminated$T5 #etnia
f <- eliminated$SEXO
anio <- 2009

}

if(xx==2011) {
  
  ingreso <- switch(var2,"ytotaj","yautaj","ytrabaj","yopraj") 
eliminated <- dataset_11[!is.na(dataset_11[,c(ingreso)]),]
a <- eliminated[,c(ingreso)]
b <- eliminated$comuna
c <- eliminated[,c(v1)]
d <- eliminated$e1 #alfabetismo
e <- eliminated$r6 #etnia
f <- eliminated$sexo
anio <- 2011

}

if(xx==2013) {
  
  ingreso <- switch(var2,"ytotcor","yautcor","ytrabajoCor","yoprCor") 
eliminated <- dataset_13[!is.na(dataset_13[,c(ingreso)]),]
a <- eliminated[,c(ingreso)]
b <- eliminated$comuna
c <- eliminated[,c(v1)]
d <- eliminated$e1 #alfabetismo
e <- eliminated$r6 #etnia
f <- eliminated$sexo
anio <- 2013

}
 

if(xx==2015) {
  
  ingreso <- switch(var2,"ytotcor","yautcor","ytrabajoCor","yoprCor") 
eliminated <- dataset_15[!is.na(dataset_15[,c(ingreso)]),]
a <- eliminated[,c(ingreso)]
b <- eliminated$comuna
c <- eliminated[,c(v1)]
d <- eliminated$e1 #alfabetismo
e <- eliminated$r3 #etnia
f <- eliminated$sexo
anio <- 2015
}

if(xx==2017) {
  
  ingreso <- switch(var2,"ytotcor","yautcor","ytrabajocor","yoprcor") 
eliminated <- dataset_17[!is.na(dataset_17[,c(ingreso)]),]
a <- eliminated[,c(ingreso)]
b <- eliminated$comuna
c <- eliminated[,c(v1)]
d <- eliminated$e1 #alfabetismo
e <- eliminated$r3 #etnia
f <- eliminated$sexo
anio <- 2017
}

if(xx==2020) {
  
  ingreso <- switch(var2,"ytotcor","yautcor","ytrabajocor","yoprcor") 
eliminated <- dataset_20[!is.na(dataset_20[,c(ingreso)]),]
a <- eliminated[,c(ingreso)]
b <- eliminated$comuna
c <- eliminated[,c(v1)]
d <- eliminated$sexo #alfabetismo
e <- eliminated$r3 #etnia
f <- eliminated$sexo
anio <- 2020
}

promedios_grupales <-aggregate(a, by=list(b, c, d, e,f), FUN = mean , na.rm = TRUE)
promedios_grupales_sd <-aggregate(a, by=list(b, c, d, e,f), FUN = sd , na.rm = TRUE)
promedios_grupales_gini <-aggregate(a, by=list(b, c, d, e,f), FUN = gini , na.rm = TRUE)

promedios_grupales$sd = promedios_grupales_sd$sd.a
promedios_grupales$gini = promedios_grupales_gini$gini.a
df<-promedios_grupales 
df$Año = xx

################ -- frecuencia
expan<-switch(n,"EXPC","EXPC","expc_full","expc","expc_todas","expc","expc")

tabla_matp <-xtabs(eliminated[,(expan)]~b+c+d+e+f, data = eliminated)
tabla_matp <- as.data.frame(tabla_matp)
tabla_matp <-tabla_matp[!(tabla_matp$Freq == 0),]
df$freq <- tabla_matp$Freq
df <- df[complete.cases(df), ]
################ 
 

names(df)[1] <- "Comuna"
names(df)[2] <- "Variable de estudio"
names(df)[3] <- "Alfabetismo"
names(df)[4] <- "Etnia"
names(df)[5] <- "Sexo"
names(df)[6] <- "Promedio del Ingreso"
names(df)[7] <- "Desviación standard"
names(df)[8] <- "Gini"
names(df)[9] <- "Año"

direc_cod_com <- paste0("C:/Users/enamo/Desktop/Shiny-R/Casen_en_pandemia_2020/",comunales)
codigos_comunales <- readRDS(file = direc_cod_com)
names(codigos_comunales)[1] <- "Código"
names(codigos_comunales)[2] <- "Comuna"

tabla_df = merge( x = df, y = codigos_comunales, by = "Comuna", all.x = TRUE)
tabla_df <-tabla_df[!(tabla_df$Promedio == 0),]

tabla_df2 <<- tabla_df
# variable_in<-"ytotcor"
# ingreso_rds <- paste("e6a_",variable_in,"_",anio,"pruebas.rds", sep="")

}

data_df3 <- data.frame()
for (n in 1:7){
  funcion1(n)

  data_df3 <- rbind(data_df3,tabla_df2)

}
variable_e <- switch(var1,"s13","o1","o2","o3","o6")
variable_i <- switch(var2,"ytotcor","yautcor","ytrabajocor","yoprcor")
# names(data_df3)[2] <- variable_e
data_df3$var_id <- paste0(variable_i,"_",variable_e)
assign(paste0("tabla_",variable_i,"_",variable_e),data_df3)
# print(paste0("tabla_",variable_i,"_",variable_e))
}
 
} 

tabla_final <- rbind(tabla_ytotcor_s13,tabla_ytotcor_o1,tabla_ytotcor_o2,tabla_ytotcor_o3,tabla_ytotcor_o6,tabla_yautcor_s13,tabla_yautcor_o1,tabla_yautcor_o2,tabla_yautcor_o3,tabla_yautcor_o6,tabla_ytrabajocor_s13,tabla_ytrabajocor_o1,tabla_ytrabajocor_o2,tabla_ytrabajocor_o3,tabla_ytrabajocor_o6)

```
 
### Homologación de etnia

```{r}
tabla_final$Etnia[tabla_final$Etnia == "Aimara" ]  <- "Aymara"
tabla_final$Etnia[tabla_final$Etnia == "No pertenece a ninguno de estos pueblos indígenas" ]  <-  "No pertenece a ningún pueblo indígena" 
tabla_final$Etnia[tabla_final$Etnia == "Mapuche"]  <- "Mapuche"
tabla_final$Etnia[tabla_final$Etnia == "Diaguita"]  <- "Diaguita"
tabla_final$Etnia[tabla_final$Etnia == "Atacameño" ]  <- "Atacameño"
tabla_final$Etnia[tabla_final$Etnia == "Atacameño (Likan-Antai)" ]  <- "Atacameño"
tabla_final$Etnia[tabla_final$Etnia == "Atacameño (Likán Antai)" ]  <- "Atacameño"
tabla_final$Etnia[tabla_final$Etnia == "Atacameño (Likán-Antai)" ]  <- "Atacameño"
tabla_final$Etnia[tabla_final$Etnia == "Quechua" ]  <- "Quechua"
tabla_final$Etnia[tabla_final$Etnia == "Yámana o Yagán" ]  <- "Yagán"
tabla_final$Etnia[tabla_final$Etnia == "Yagan" ]  <- "Yagán"
tabla_final$Etnia[tabla_final$Etnia == "Yagán (Yámana)" ]  <- "Yagán"
tabla_final$Etnia[tabla_final$Etnia == "Rapa-Nui o Pascuenses"]  <- "Pascuense"
tabla_final$Etnia[tabla_final$Etnia == "Rapa-Nui"]  <- "Pascuense"
tabla_final$Etnia[tabla_final$Etnia == "Rapa Nui (Pascuense)"]  <- "Pascuense"
tabla_final$Etnia[tabla_final$Etnia == "Rapa Nui"]  <- "Pascuense"
tabla_final$Etnia[tabla_final$Etnia == "Collas"]  <- "Coya"
tabla_final$Etnia[tabla_final$Etnia == "Kawashkar o Alacalufes" ]  <- "Alacalufe"
tabla_final$Etnia[tabla_final$Etnia == "Kawashkar" ]  <- "Alacalufe"
tabla_final$Etnia[tabla_final$Etnia == "Kawésqar (Alacalufes)" ]  <- "Alacalufe"
tabla_final$Etnia[tabla_final$Etnia == "Kawésqar" ]  <- "Alacalufe"
tabla_final$Etnia[tabla_final$Etnia == "Kawaskar" ]  <- "Alacalufe"
tabla_final$Etnia[tabla_final$Etnia == "Chango" ]  <- "Chango"
tabla_final$Etnia[tabla_final$Etnia ==  "Sin dato"]  <- NA
tabla_final$Etnia[tabla_final$Etnia ==  "NS/NR"   ]  <- NA
tabla_final$Etnia[tabla_final$Etnia == "No sabe/no responde" ]  <- NA

```

 
 

# Ingreso total *ytotcor*

## **s13** ¿A qué sistema previsional de salud pertenece usted? 

```{r, message=FALSE, warning=FALSE}
tabla_ytotcor_s13 <- filter(tabla_final,tabla_final$var_id == "ytotcor_s13")
names(tabla_ytotcor_s13)[2] <- str_replace_all(tabla_ytotcor_s13[1,12],"ytotcor_","")

datatable(tabla_ytotcor_s13[,c(1:11)], extensions = 'Buttons', escape = FALSE, rownames = FALSE,
          options = list(dom = 'Bfrtip',
          buttons = list('colvis', list(extend = 'collection',
          buttons = list(
          list(extend='copy'),
          list(extend='excel',
            filename = 'tabla_ytotcor_s13'),
          list(extend='pdf',
            filename= 'tabla_ytotcor_s13')),
          text = 'Download')), scrollX = TRUE))%>%
    formatRound(columns=c("Promedio del Ingreso","Desviación standard","Gini") ,mark = "", digits=3)
```

## **o1** La semana pasada, ¿trabajó al menos una hora?

```{r, message=FALSE, warning=FALSE}
tabla_ytotcor_o1 <- filter(tabla_final,tabla_final$var_id == "ytotcor_o1")
names(tabla_ytotcor_o1)[2] <- str_replace_all(tabla_ytotcor_o1[1,12],"ytotcor_","")

datatable(tabla_ytotcor_o1[,c(1:11)], extensions = 'Buttons', escape = FALSE, rownames = FALSE,
          options = list(dom = 'Bfrtip',
          buttons = list('colvis', list(extend = 'collection',
          buttons = list(
          list(extend='copy'),
          list(extend='excel',
            filename = 'tabla_ytotcor_o1'),
          list(extend='pdf',
            filename= 'tabla_ytotcor_o1')),
          text = 'Download')), scrollX = TRUE))%>%
    formatRound(columns=c("Promedio del Ingreso","Desviación standard","Gini") ,mark = "", digits=3)
```

## **o2** ¿Aunque no trabajó la semana pasada, ¿realizó alguna actividad?

```{r, message=FALSE, warning=FALSE}
tabla_ytotcor_o2 <- filter(tabla_final,tabla_final$var_id == "ytotcor_o2")
names(tabla_ytotcor_o2)[2] <- str_replace_all(tabla_ytotcor_o2[1,12],"ytotcor_","")

datatable(tabla_ytotcor_o2[,c(1:11)], extensions = 'Buttons', escape = FALSE, rownames = FALSE,
          options = list(dom = 'Bfrtip',
          buttons = list('colvis', list(extend = 'collection',
          buttons = list(
          list(extend='copy'),
          list(extend='excel',
            filename = 'tabla_ytotcor_o2'),
          list(extend='pdf',
            filename= 'tabla_ytotcor_o2')),
          text = 'Download')), scrollX = TRUE))%>%
    formatRound(columns=c("Promedio del Ingreso","Desviación standard","Gini") ,mark = "", digits=3)
```

## **o3** ¿Aunque no trabajó la semana pasada, ¿tenía algún empleo del cual estuvo ausente temporalmente por licencia, huelga, enfermedad, vacaciones u otra razón?

```{r, message=FALSE, warning=FALSE}
tabla_ytotcor_o3 <- filter(tabla_final,tabla_final$var_id == "ytotcor_o3")
names(tabla_ytotcor_o3)[2] <- str_replace_all(tabla_ytotcor_o3[1,12],"ytotcor_","")

datatable(tabla_ytotcor_o3[,c(1:11)], extensions = 'Buttons', escape = FALSE, rownames = FALSE,
          options = list(dom = 'Bfrtip',
          buttons = list('colvis', list(extend = 'collection',
          buttons = list(
          list(extend='copy'),
          list(extend='excel',
            filename = 'tabla_ytotcor_o3'),
          list(extend='pdf',
            filename= 'tabla_ytotcor_o3')),
          text = 'Download')), scrollX = TRUE))%>%
    formatRound(columns=c("Promedio del Ingreso","Desviación standard","Gini") ,mark = "", digits=3)
```

## **O6** ¿Buscó trabajo remunerado en las últimas cuatro semanas?

```{r, message=FALSE, warning=FALSE}
tabla_ytotcor_o6 <- filter(tabla_final,tabla_final$var_id == "ytotcor_o6")
names(tabla_ytotcor_o6)[2] <- str_replace_all(tabla_ytotcor_o6[1,12],"ytotcor_","")

datatable(tabla_ytotcor_o6[,c(1:11)], extensions = 'Buttons', escape = FALSE, rownames = FALSE,
          options = list(dom = 'Bfrtip',
          buttons = list('colvis', list(extend = 'collection',
          buttons = list(
          list(extend='copy'),
          list(extend='excel',
            filename = 'tabla_ytotcor_o6'),
          list(extend='pdf',
            filename= 'tabla_ytotcor_o6')),
          text = 'Download')), scrollX = TRUE))%>%
    formatRound(columns=c("Promedio del Ingreso","Desviación standard","Gini") ,mark = "", digits=3)
```


# Ingreso autonomo *yautcor*

## **s13** ¿A qué sistema previsional de salud pertenece usted?

```{r, message=FALSE, warning=FALSE}
tabla_yautcor_s13 <- filter(tabla_final,tabla_final$var_id == "yautcor_s13")
names(tabla_yautcor_s13)[2] <- str_replace_all(tabla_yautcor_s13[1,12],"yautcor_","")

datatable(tabla_yautcor_s13[,c(1:11)], extensions = 'Buttons', escape = FALSE, rownames = FALSE,
          options = list(dom = 'Bfrtip',
          buttons = list('colvis', list(extend = 'collection',
          buttons = list(
          list(extend='copy'),
          list(extend='excel',
            filename = 'tabla_yautcor_s13'),
          list(extend='pdf',
            filename= 'tabla_yautcor_s13')),
          text = 'Download')), scrollX = TRUE))%>%
    formatRound(columns=c("Promedio del Ingreso","Desviación standard","Gini") ,mark = "", digits=3)
```

## **o1** La semana pasada, ¿trabajó al menos una hora?

```{r, message=FALSE, warning=FALSE}
tabla_yautcor_o1 <- filter(tabla_final,tabla_final$var_id == "yautcor_o1")
names(tabla_yautcor_o1)[2] <- str_replace_all(tabla_yautcor_o1[1,12],"yautcor_","")

datatable(tabla_yautcor_o1[,c(1:11)], extensions = 'Buttons', escape = FALSE, rownames = FALSE,
          options = list(dom = 'Bfrtip',
          buttons = list('colvis', list(extend = 'collection',
          buttons = list(
          list(extend='copy'),
          list(extend='excel',
            filename = 'tabla_yautcor_o1'),
          list(extend='pdf',
            filename= 'tabla_yautcor_o1')),
          text = 'Download')), scrollX = TRUE))%>%
    formatRound(columns=c("Promedio del Ingreso","Desviación standard","Gini") ,mark = "", digits=3)
```

## **o2** ¿Aunque no trabajó la semana pasada, ¿realizó alguna actividad?

```{r, message=FALSE, warning=FALSE}
tabla_yautcor_o2 <- filter(tabla_final,tabla_final$var_id == "yautcor_o2")
names(tabla_yautcor_o2)[2] <- str_replace_all(tabla_yautcor_o2[1,12],"yautcor_","")

datatable(tabla_yautcor_o2[,c(1:11)], extensions = 'Buttons', escape = FALSE, rownames = FALSE,
          options = list(dom = 'Bfrtip',
          buttons = list('colvis', list(extend = 'collection',
          buttons = list(
          list(extend='copy'),
          list(extend='excel',
            filename = 'tabla_yautcor_o2'),
          list(extend='pdf',
            filename= 'tabla_yautcor_o2')),
          text = 'Download')), scrollX = TRUE))%>%
    formatRound(columns=c("Promedio del Ingreso","Desviación standard","Gini") ,mark = "", digits=3)
```

## **o3** ¿Aunque no trabajó la semana pasada, ¿tenía algún empleo del cual estuvo ausente temporalmente por licencia, huelga, enfermedad, vacaciones u otra razón?

```{r, message=FALSE, warning=FALSE}
tabla_yautcor_o3 <- filter(tabla_final,tabla_final$var_id == "yautcor_o3")
names(tabla_yautcor_o3)[2] <- str_replace_all(tabla_yautcor_o3[1,12],"yautcor_","")

datatable(tabla_yautcor_o3[,c(1:11)], extensions = 'Buttons', escape = FALSE, rownames = FALSE,
          options = list(dom = 'Bfrtip',
          buttons = list('colvis', list(extend = 'collection',
          buttons = list(
          list(extend='copy'),
          list(extend='excel',
            filename = 'tabla_yautcor_o3'),
          list(extend='pdf',
            filename= 'tabla_yautcor_o3')),
          text = 'Download')), scrollX = TRUE))%>%
    formatRound(columns=c("Promedio del Ingreso","Desviación standard","Gini") ,mark = "", digits=3)
```

## **O6** ¿Buscó trabajo remunerado en las últimas cuatro semanas?

```{r, message=FALSE, warning=FALSE}
tabla_yautcor_o6 <- filter(tabla_final,tabla_final$var_id == "yautcor_o6")
names(tabla_yautcor_o6)[2] <- str_replace_all(tabla_yautcor_o6[1,12],"yautcor_","")

datatable(tabla_yautcor_o6[,c(1:11)], extensions = 'Buttons', escape = FALSE, rownames = FALSE,
          options = list(dom = 'Bfrtip',
          buttons = list('colvis', list(extend = 'collection',
          buttons = list(
          list(extend='copy'),
          list(extend='excel',
            filename = 'tabla_yautcor_o6'),
          list(extend='pdf',
            filename= 'tabla_yautcor_o6')),
          text = 'Download')), scrollX = TRUE))%>%
    formatRound(columns=c("Promedio del Ingreso","Desviación standard","Gini") ,mark = "", digits=3)
```

# Ingreso del trabajo *ytrabajocor*

## **s13** ¿A qué sistema previsional de salud pertenece usted?

```{r, message=FALSE, warning=FALSE}
tabla_ytrabajocor_s13 <- filter(tabla_final,tabla_final$var_id == "ytrabajocor_s13")
names(tabla_ytrabajocor_s13)[2] <- str_replace_all(tabla_ytrabajocor_s13[1,12],"ytrabajocor_","")

datatable(tabla_ytrabajocor_s13[,c(1:11)], extensions = 'Buttons', escape = FALSE, rownames = FALSE,
          options = list(dom = 'Bfrtip',
          buttons = list('colvis', list(extend = 'collection',
          buttons = list(
          list(extend='copy'),
          list(extend='excel',
            filename = 'tabla_ytrabajocor_s13'),
          list(extend='pdf',
            filename= 'tabla_ytrabajocor_s13')),
          text = 'Download')), scrollX = TRUE))%>%
    formatRound(columns=c("Promedio del Ingreso","Desviación standard","Gini") ,mark = "", digits=3)
```

## **o1** La semana pasada, ¿trabajó al menos una hora?

```{r, message=FALSE, warning=FALSE}
tabla_ytrabajocor_o1 <- filter(tabla_final,tabla_final$var_id == "ytrabajocor_o1")
names(tabla_ytrabajocor_o1)[2] <- str_replace_all(tabla_ytrabajocor_o1[1,12],"ytrabajocor_","")

datatable(tabla_ytrabajocor_o1[,c(1:11)], extensions = 'Buttons', escape = FALSE, rownames = FALSE,
          options = list(dom = 'Bfrtip',
          buttons = list('colvis', list(extend = 'collection',
          buttons = list(
          list(extend='copy'),
          list(extend='excel',
            filename = 'tabla_ytrabajocor_o1'),
          list(extend='pdf',
            filename= 'tabla_ytrabajocor_o1')),
          text = 'Download')), scrollX = TRUE))%>%
    formatRound(columns=c("Promedio del Ingreso","Desviación standard","Gini") ,mark = "", digits=3)
```

## **o2** ¿Aunque no trabajó la semana pasada, ¿realizó alguna actividad?

```{r, message=FALSE, warning=FALSE}
tabla_ytrabajocor_o2 <- filter(tabla_final,tabla_final$var_id == "ytrabajocor_o2")
names(tabla_ytrabajocor_o2)[2] <- str_replace_all(tabla_ytrabajocor_o2[1,12],"ytrabajocor_","")

datatable(tabla_ytrabajocor_o2[,c(1:11)], extensions = 'Buttons', escape = FALSE, rownames = FALSE,
          options = list(dom = 'Bfrtip',
          buttons = list('colvis', list(extend = 'collection',
          buttons = list(
          list(extend='copy'),
          list(extend='excel',
            filename = 'tabla_ytrabajocor_o2'),
          list(extend='pdf',
            filename= 'tabla_ytrabajocor_o2')),
          text = 'Download')), scrollX = TRUE))%>%
    formatRound(columns=c("Promedio del Ingreso","Desviación standard","Gini") ,mark = "", digits=3)
```

## **o3** ¿Aunque no trabajó la semana pasada, ¿tenía algún empleo del cual estuvo ausente temporalmente por licencia, huelga, enfermedad, vacaciones u otra razón?

```{r, message=FALSE, warning=FALSE}
tabla_ytrabajocor_o3 <- filter(tabla_final,tabla_final$var_id == "ytrabajocor_o3")
names(tabla_ytrabajocor_o3)[2] <- str_replace_all(tabla_ytrabajocor_o3[1,12],"ytrabajocor_","")

datatable(tabla_ytrabajocor_o3[,c(1:11)], extensions = 'Buttons', escape = FALSE, rownames = FALSE,
          options = list(dom = 'Bfrtip',
          buttons = list('colvis', list(extend = 'collection',
          buttons = list(
          list(extend='copy'),
          list(extend='excel',
            filename = 'tabla_ytrabajocor_o3'),
          list(extend='pdf',
            filename= 'tabla_ytrabajocor_o3')),
          text = 'Download')), scrollX = TRUE))%>%
    formatRound(columns=c("Promedio del Ingreso","Desviación standard","Gini") ,mark = "", digits=3)
```

## **O6** ¿Buscó trabajo remunerado en las últimas cuatro semanas?

```{r, message=FALSE, warning=FALSE}
tabla_ytrabajocor_o6 <- filter(tabla_final,tabla_final$var_id == "ytrabajocor_o6")
names(tabla_ytrabajocor_o6)[2] <- str_replace_all(tabla_ytrabajocor_o6[1,12],"ytrabajocor_","")

datatable(tabla_ytrabajocor_o6[,c(1:11)], extensions = 'Buttons', escape = FALSE, rownames = FALSE,
          options = list(dom = 'Bfrtip',
          buttons = list('colvis', list(extend = 'collection',
          buttons = list(
          list(extend='copy'),
          list(extend='excel',
            filename = 'tabla_ytrabajocor_o6'),
          list(extend='pdf',
            filename= 'tabla_ytrabajocor_o6')),
          text = 'Download')), scrollX = TRUE))%>%
    formatRound(columns=c("Promedio del Ingreso","Desviación standard","Gini") ,mark = "", digits=3)
```






# Pruebas.

Hicimos pruebas pero tuvimos problemas al no tener puntos de comparación, al parecer somos los únicos que estamos haciendo este tipo de categorizaciones. El método no es científico, no llega al mismo resultado a través de distintos procedimientos, sólo debemos confiar en lo correcto de los pasos previos.

![title](prueba_1.png)

![title](prueba_2.png)

![title](prueba_3.png)

 

<!-- # ```{r} -->
<!-- #  -->
<!-- #   ingreso <- switch(3,"YTOTAJ","yautcor","ytrabaj","yoprcor")  -->
<!-- # eliminated <- dataset_11[!is.na(dataset_11[,c(ingreso)]),] -->
<!-- # a <- eliminated[,c(ingreso)] -->
<!-- # b <- eliminated$comuna -->
<!-- # c <- eliminated$s17 -->
<!-- # d <- eliminated$e1 #alfabetismo -->
<!-- # e <- eliminated$r6 #etnia -->
<!-- # f <- eliminated$sexo -->
<!-- # anio <- 2011 -->
<!-- #  -->
<!-- # promedios_grupales <-aggregate(a, by=list(b, c, d, e,f), FUN = mean , na.rm = TRUE) -->
<!-- # promedios_grupales_sd <-aggregate(a, by=list(b, c, d, e,f), FUN = sd , na.rm = TRUE) -->
<!-- # promedios_grupales_gini <-aggregate(a, by=list(b, c, d, e,f), FUN = gini , na.rm = TRUE) -->
<!-- #  -->
<!-- # promedios_grupales$sd = promedios_grupales_sd$sd.a -->
<!-- # promedios_grupales$gini = promedios_grupales_gini$gini.a -->
<!-- # df<-promedios_grupales  -->
<!-- #  -->
<!-- # ################ -- frecuencia -->
<!-- # expan<-switch(3,"EXPC","EXPC","expc_full","expc","expc_todas","expc","expc") -->
<!-- #  -->
<!-- # tabla_matp <-xtabs(eliminated[,(expan)]~b+c+d+e+f, data = eliminated) -->
<!-- # tabla_matp <- as.data.frame(tabla_matp) -->
<!-- # tabla_matp <-tabla_matp[!(tabla_matp$Freq == 0),] -->
<!-- # df$freq <- tabla_matp$Freq -->
<!-- # df <- df[complete.cases(df), ] -->
<!-- #  -->
<!-- # names(df)[1] <- "Comuna" -->
<!-- # names(df)[2] <- "Variable de estudio" -->
<!-- # names(df)[3] <- "Alfabetismo" -->
<!-- # names(df)[4] <- "Etnia" -->
<!-- # names(df)[5] <- "Sexo" -->
<!-- # names(df)[6] <- "Promedio del Ingreso" -->
<!-- # names(df)[7] <- "Desviación standard" -->
<!-- # names(df)[8] <- "Gini" -->
<!-- # # names(df)[9] <- "Año" -->
<!-- # df -->
<!-- # ################  -->
<!-- # ``` -->

<!-- # ```{r} -->
<!-- # pruebas <- filter(df, df$Comuna == "Nancagua") -->
<!-- # pruebas <- filter(pruebas, pruebas$Sexo == "Hombre") -->
<!-- # pruebas <- filter(pruebas, pruebas$Etnia == "No pertenece a ningún pueblo indígena") -->
<!-- # pruebas <- filter(pruebas, pruebas$Alfabetismo == "Sí") -->
<!-- # pruebas <- filter(pruebas, pruebas$`Variable de estudio` == "ISAPRE") -->
<!-- # pruebas -->
<!-- # # sum(pruebas$`Promedio del Ingreso`*pruebas$freq ) -->
<!-- # ``` -->
 
 





























