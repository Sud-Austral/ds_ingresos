filename = 'promedio_percapita_ingreso_yoprcorh_2011-2020'),
list(extend='pdf',
filename= 'promedio_percapita_ingreso_yoprcorh_2011-2020')),
text = 'Download')), scrollX = TRUE))
p <- plot_ly(tabla_percapita, width = 1200, x = ~Comuna, y = ~calculo_2011, name = 'calculado_2011', mode = 'markers') %>% add_lines()
p <- p %>% add_lines(y = ~calculo_2013, name = 'calculado_2011', mode = 'markers')
p <- p %>% add_lines(y = ~calculo_2015, name = 'calculado_2015', mode = 'markers')
p <- p %>% add_lines(y = ~calculo_2017, name = 'calculado_2017', mode = 'markers')
p <- p %>% add_lines(y = ~calculo_2020, name = 'calculado_2020', mode = 'markers')
p
# ###
# casen2017$r3[casen2017$r3 == "No pertenece a ningún pueblo indígena"] <- "No pertenece a ninguno de estos pueblos indígenas"
# casen2017$r3[casen2017$r3 == "No sabe/no responde"] <- "No pertenece a ninguno de estos pueblos indígenas"
# casen2017$r3[casen2017$r3 == "Mapuche"] <- "Mapuche"
# casen2017$r3[casen2017$r3 == "Diaguita"] <- "Diaguita"
# casen2017$r3[casen2017$r3 == "Collas"] <- "Collas"
# casen2017$r3[casen2017$r3 == "Quechua"] <- "Quechua"
# casen2017$r3[casen2017$r3 == "Yámana o Yagán"] <- "Yámana o Yagán"
# casen2017$r3[casen2017$r3 == "Aimara"] <- "Aimara"
# casen2017$r3[casen2017$r3 == "Rapa-Nui o Pascuenses"] <- "Rapa-Nui o Pascuenses"
# casen2017$r3[casen2017$r3 == "Atacameño (Likan-Antai)"] <- "Atacameño (Likan-Antai)"
# casen2017$r3[casen2017$r3 == "Kawashkar o Alacalufes"] <- "Kawashkar o Alacalufes"
# ###
# casen2015$r3[casen2015$r3 == "No pertenece a ningún pueblo indígena"] <- "No pertenece a ninguno de estos pueblos indígenas"
# casen2015$r3[casen2015$r3 == "Sin dato"] <- "No pertenece a ninguno de estos pueblos indígenas"
# casen2015$r3[casen2015$r3 == "Mapuche"] <- "Mapuche"
# casen2015$r3[casen2015$r3 == "Diaguita"] <- "Diaguita"
# casen2015$r3[casen2015$r3 == "Collas"] <- "Collas"
# casen2015$r3[casen2015$r3 == "Quechua"] <- "Quechua"
# casen2015$r3[casen2015$r3 == "Yámana o Yagán"] <- "Yámana o Yagán"
# casen2015$r3[casen2015$r3 == "Aimara"] <- "Aimara"
# casen2015$r3[casen2015$r3 == "Rapa-Nui o Pascuenses"] <- "Rapa-Nui o Pascuenses"
# casen2015$r3[casen2015$r3 == "Atacameño (Likán-Antai)"] <- "Atacameño (Likan-Antai)"
# casen2015$r3[casen2015$r3 == "Kawashkar o Alacalufes"] <- "Kawashkar o Alacalufes"
# ###
# casen2013$r6[casen2013$r6 == "No pertenece a ningún pueblo indígena"] <- "No pertenece a ninguno de estos pueblos indígenas"
# casen2013$r6[casen2013$r6 == "NS/NR"] <- "No pertenece a ninguno de estos pueblos indígenas"
# casen2013$r6[casen2013$r6 == "Mapuche"] <- "Mapuche"
# casen2013$r6[casen2013$r6 == "Diaguita"] <- "Diaguita"
# casen2013$r6[casen2013$r6 == "Coya"] <- "Collas"
# casen2013$r6[casen2013$r6 == "Quechua"] <- "Quechua"
# casen2013$r6[casen2013$r6 == "Yagán (Yámana)"] <- "Yámana o Yagán"
# casen2013$r6[casen2013$r6 == "Aymara"] <- "Aimara"
# casen2013$r6[casen2013$r6 == "Rapa Nui (Pascuense)"] <- "Rapa-Nui o Pascuenses"
# casen2013$r6[casen2013$r6 == "Atacameño (Likán Antai)"] <- "Atacameño (Likan-Antai)"
# casen2013$r6[casen2013$r6 == "Kawésqar (Alacalufes)"] <- "Kawashkar o Alacalufes"
# ###
# casen2011$r6[casen2011$r6 == "No pertenece a ningún pueblo indígena"] <- "No pertenece a ninguno de estos pueblos indígenas"
# casen2011$r6[casen2011$r6 == "Mapuche"] <- "Mapuche"
# casen2011$r6[casen2011$r6 == "Diaguita"] <- "Diaguita"
# casen2011$r6[casen2011$r6 == "Coya"] <- "Collas"
# casen2011$r6[casen2011$r6 == "Quechua"] <- "Quechua"
# casen2011$r6[casen2011$r6 == "Yagán (Yámana)"] <- "Yámana o Yagán"
# casen2011$r6[casen2011$r6 == "Aymara"] <- "Aimara"
# casen2011$r6[casen2011$r6 == "Rapa Nui (Pascuense)"] <- "Rapa-Nui o Pascuenses"
# casen2011$r6[casen2011$r6 == "Atacameño (Likán Antai)"] <- "Atacameño (Likan-Antai)"
# casen2011$r6[casen2011$r6 == "Kawésqar (Alacalufes)"] <- "Kawashkar o Alacalufes"
#
#
# saveRDS(casen2017,"C:/Users/enamo/Desktop/Shiny-R/Casen_en_pandemia_2020/casen/casen_2017_c2.rds")
# saveRDS(casen2015,"C:/Users/enamo/Desktop/Shiny-R/Casen_en_pandemia_2020/casen/casen_2015_c2.rds")
# saveRDS(casen2013,"C:/Users/enamo/Desktop/Shiny-R/Casen_en_pandemia_2020/casen/casen_2013_c2.rds")
# saveRDS(casen2011,"C:/Users/enamo/Desktop/Shiny-R/Casen_en_pandemia_2020/casen/casen_2011_c2.rds")
codigos_comunales <- readRDS(file = "C:/Users/chris/OneDrive/Documentos/archivos_grandes/codigos_comunales_2011-2017.rds")
#codigos_comunales <- readRDS(file = "C:/Users/enamo/Desktop/Shiny-R/Casen_en_pandemia_2020/codigos_comunales_2011-2017.rds")
funcion1 <- function(n){
xx<-switch(n,"2011","2013","2015","2017","2020")
tanios <<- xx
expan<-switch(n,"expc_full","expc","expc_todas","expc","expc")
if(xx==2011) {
eliminated <- casen2011
a <- eliminated$ytotaj#ytothaj
b <- eliminated$comuna
c <- eliminated$sexo
d <- eliminated$r6 #etnia
anio <- 2011
}
if(xx==2013) {
eliminated <- casen2013
a <- eliminated$ytotcor#ytotcorh
b <- eliminated$comuna
c <- eliminated$sexo
d <- eliminated$r6 #etnia
anio <- 2013
}
if(xx==2015) {
eliminated <- casen2015
a <- eliminated$ytotcor#ytotcorh
b <- eliminated$comuna
c <- eliminated$sexo
d <- eliminated$r3 #etnia
anio <- 2015
}
if(xx==2017) {
eliminated <- casen2017
a <- eliminated$ytotcor#ytotcorh
b <- eliminated$comuna
c <- eliminated$sexo
d <- eliminated$r3 #etnia
anio <- 2017
}
if(xx==2020) {
eliminated <- casen2020
a <- eliminated$ytotcor#ytotcorh
b <- eliminated$comuna
c <- eliminated$sexo
d <- eliminated$r3 #etnia
anio <- 2020
}
tpi <- "ytotcor"
promedios_grupales <-aggregate(a, by=list(b, c, d), FUN = mean , na.rm = TRUE)
promedios_grupales_sd <-aggregate(a, by=list(b, c, d), FUN = sd , na.rm = TRUE)
promedios_grupales_gini <-aggregate(a, by=list(b, c, d), FUN = gini , na.rm = TRUE)
promedios_grupales$sd = promedios_grupales_sd$sd.a
promedios_grupales$gini = promedios_grupales_gini$gini.a
df<-promedios_grupales
df$Año <- anio
df$tipo_ingreso <- tpi
tabla_matp <-xtabs(eliminated[,(expan)]~b+c+d, data = eliminated)
tabla_matp <- as.data.frame(tabla_matp)
tabla_matp <-tabla_matp[!(tabla_matp$Freq == 0),]
df$freq <- tabla_matp$Freq
df <- df[complete.cases(df), ]
names(df)[1] <- "Comuna"
names(df)[2] <- "Sexo"
names(df)[3] <- "Etnia"
names(df)[4] <- "Promedio del Ingreso"
names(df)[5] <- "Desviación standard"
names(df)[6] <- "Gini"
names(df)[7] <- "Año"
names(codigos_comunales)[1] <- "Código"
names(codigos_comunales)[2] <- "Comuna"
# codigos_comunales
df_tabla = merge( x = df, y = codigos_comunales, by = "Comuna", all.x = TRUE)
df <-df_tabla[!(df_tabla$Promedio == 0),]
tabla <<- df
}
for (n in 1:5){
funcion1(n)
assign(paste0("tabla","_",tanios),tabla)
}
tabla_cont_freq <- rbind(tabla_2011,tabla_2013,tabla_2015,tabla_2017,tabla_2020)
datatable(tabla_cont_freq, extensions = 'Buttons', escape = FALSE, rownames = FALSE,
options = list(dom = 'Bfrtip',
buttons = list('colvis', list(extend = 'collection',
buttons = list(
list(extend='csv',
filename = 'hitStats'),
list(extend='excel',
filename = 'hitStats'),
list(extend='pdf',
filename= 'hitStats')),
text = 'Download')), scrollX = TRUE))
codigos_comunales <- readRDS(file = "C:/Users/chris/OneDrive/Documentos/archivos_grandes/codigos_comunales_2011-2017.rds")
#codigos_comunales <- readRDS(file = "C:/Users/enamo/Desktop/Shiny-R/Casen_en_pandemia_2020/codigos_comunales_2011-2017.rds")
funcion1 <- function(n){
xx<-switch(n,"2011","2013","2015","2017","2020")
tanios <<- xx
expan<-switch(n,"expc_full","expc","expc_todas","expc","expc")
if(xx==2011) {
eliminated <- casen2011
a <- eliminated$yautaj#yauthaj
b <- eliminated$comuna
c <- eliminated$sexo
d <- eliminated$r6 #etnia
anio <- 2011
tpi <- "yautcor"
}
if(xx==2013) {
eliminated <- casen2013
a <- eliminated$yautcor#yautcorh
b <- eliminated$comuna
c <- eliminated$sexo
d <- eliminated$r6 #etnia
anio <- 2013
tpi <- "yautcor"
}
if(xx==2015) {
eliminated <- casen2015
a <- eliminated$yautcor#yautcorh
b <- eliminated$comuna
c <- eliminated$sexo
d <- eliminated$r3 #etnia
anio <- 2015
tpi <- "yautcor"
}
if(xx==2017) {
eliminated <- casen2017
a <- eliminated$yautcor#yautcorh
b <- eliminated$comuna
c <- eliminated$sexo
d <- eliminated$r3 #etnia
anio <- 2017
tpi <- "yautcor"
}
if(xx==2020) {
eliminated <- casen2020
a <- eliminated$yautcor#yautcorh
b <- eliminated$comuna
c <- eliminated$sexo
d <- eliminated$r3 #etnia
anio <- 2020
tpi <- "yautcor"
}
promedios_grupales <-aggregate(a, by=list(b, c, d), FUN = mean , na.rm = TRUE)
promedios_grupales_sd <-aggregate(a, by=list(b, c, d), FUN = sd , na.rm = TRUE)
promedios_grupales_gini <-aggregate(a, by=list(b, c, d), FUN = gini , na.rm = TRUE)
promedios_grupales$sd = promedios_grupales_sd$sd.a
promedios_grupales$gini = promedios_grupales_gini$gini.a
df<-promedios_grupales
df$Año <- anio
df$tipo_ingreso <- tpi
tabla_matp <-xtabs(eliminated[,(expan)]~b+c+d, data = eliminated)
tabla_matp <- as.data.frame(tabla_matp)
tabla_matp <-tabla_matp[!(tabla_matp$Freq == 0),]
df$freq <- tabla_matp$Freq
df <- df[complete.cases(df), ]
names(df)[1] <- "Comuna"
names(df)[2] <- "Sexo"
names(df)[3] <- "Etnia"
names(df)[4] <- "Promedio del Ingreso"
names(df)[5] <- "Desviación standard"
names(df)[6] <- "Gini"
names(df)[7] <- "Año"
names(codigos_comunales)[1] <- "Código"
names(codigos_comunales)[2] <- "Comuna"
# codigos_comunales
df_tabla = merge( x = df, y = codigos_comunales, by = "Comuna", all.x = TRUE)
df <-df_tabla[!(df_tabla$Promedio == 0),]
tabla <<- df
}
for (n in 1:5){
funcion1(n)
assign(paste0("tabla","_",tanios),tabla)
}
tabla_cont_freq <- rbind(tabla_2011,tabla_2013,tabla_2015,tabla_2017,tabla_2020)
datatable(tabla_cont_freq, extensions = 'Buttons', escape = FALSE, rownames = FALSE,
options = list(dom = 'Bfrtip',
buttons = list('colvis', list(extend = 'collection',
buttons = list(
list(extend='csv',
filename = 'hitStats'),
list(extend='excel',
filename = 'hitStats'),
list(extend='pdf',
filename= 'hitStats')),
text = 'Download')), scrollX = TRUE))
codigos_comunales <- readRDS(file = "C:/Users/chris/OneDrive/Documentos/archivos_grandes/codigos_comunales_2011-2017.rds")
#codigos_comunales <- readRDS(file = "C:/Users/enamo/Desktop/Shiny-R/Casen_en_pandemia_2020/codigos_comunales_2011-2017.rds")
funcion1 <- function(n){
xx<-switch(n,"2011","2013","2015","2017","2020")
tanios <<- xx
expan<-switch(n,"expc_full","expc","expc_todas","expc","expc")
if(xx==2011) {
eliminated <- casen2011
a <- eliminated$ytrabaj#yauthaj
b <- eliminated$comuna
c <- eliminated$sexo
d <- eliminated$r6 #etnia
anio <- 2011
}
if(xx==2013) {
eliminated <- casen2013
a <- eliminated$ytrabajoCor#yautcorh
b <- eliminated$comuna
c <- eliminated$sexo
d <- eliminated$r6 #etnia
anio <- 2013
}
if(xx==2015) {
eliminated <- casen2015
a <- eliminated$ytrabajoCor#yautcorh
b <- eliminated$comuna
c <- eliminated$sexo
d <- eliminated$r3 #etnia
anio <- 2015
}
if(xx==2017) {
eliminated <- casen2017
a <- eliminated$ytrabajocor#yautcorh
b <- eliminated$comuna
c <- eliminated$sexo
d <- eliminated$r3 #etnia
anio <- 2017
}
if(xx==2020) {
eliminated <- casen2020
a <- eliminated$ytrabajocor#yautcorh
b <- eliminated$comuna
c <- eliminated$sexo
d <- eliminated$r3 #etnia
anio <- 2020
}
tpi <- "ytrabajocor"
promedios_grupales <-aggregate(a, by=list(b, c, d), FUN = mean , na.rm = TRUE)
promedios_grupales_sd <-aggregate(a, by=list(b, c, d), FUN = sd , na.rm = TRUE)
promedios_grupales_gini <-aggregate(a, by=list(b, c, d), FUN = gini , na.rm = TRUE)
promedios_grupales$sd = promedios_grupales_sd$sd.a
promedios_grupales$gini = promedios_grupales_gini$gini.a
df<-promedios_grupales
df$Año <- anio
df$tipo_ingreso <- tpi
tabla_matp <-xtabs(eliminated[,(expan)]~b+c+d, data = eliminated)
tabla_matp <- as.data.frame(tabla_matp)
tabla_matp <-tabla_matp[!(tabla_matp$Freq == 0),]
df$freq <- tabla_matp$Freq
df <- df[complete.cases(df), ]
names(df)[1] <- "Comuna"
names(df)[2] <- "Sexo"
names(df)[3] <- "Etnia"
names(df)[4] <- "Promedio del Ingreso"
names(df)[5] <- "Desviación standard"
names(df)[6] <- "Gini"
names(df)[7] <- "Año"
names(codigos_comunales)[1] <- "Código"
names(codigos_comunales)[2] <- "Comuna"
# codigos_comunales
df_tabla = merge( x = df, y = codigos_comunales, by = "Comuna", all.x = TRUE)
df <-df_tabla[!(df_tabla$Promedio == 0),]
tabla <<- df
}
for (n in 1:5){
funcion1(n)
assign(paste0("tabla","_",tanios),tabla)
}
tabla_cont_freq <- rbind(tabla_2011,tabla_2013,tabla_2015,tabla_2017,tabla_2020)
datatable(tabla_cont_freq, extensions = 'Buttons', escape = FALSE, rownames = FALSE,
options = list(dom = 'Bfrtip',
buttons = list('colvis', list(extend = 'collection',
buttons = list(
list(extend='csv',
filename = 'hitStats'),
list(extend='excel',
filename = 'hitStats'),
list(extend='pdf',
filename= 'hitStats')),
text = 'Download')), scrollX = TRUE))
# codigos_comunales <- readRDS(file = "C:/Users/enamo/Desktop/Shiny-R/Casen_en_pandemia_2020/codigos_comunales_2011-2017.rds")
funcion1 <- function(n){
xx<-switch(n,"2011","2013","2015","2017","2020")
tanios <<- xx
expan<-switch(n,"expc_full","expc","expc_todas","expc","expc")
if(xx==2011) {
eliminated <- casen2011
a <- eliminated$yopraj#yauthaj
b <- eliminated$comuna
c <- eliminated$sexo
d <- eliminated$r6 #etnia
anio <- 2011
tpi <- "yoprcor"
}
if(xx==2013) {
eliminated <- casen2013
a <- eliminated$yoprCor#ytrabajocorh
b <- eliminated$comuna
c <- eliminated$sexo
d <- eliminated$r6 #etnia
anio <- 2013
tpi <- "yoprcor"
}
if(xx==2015) {
eliminated <- casen2015
a <- eliminated$yoprCor#ytrabajoCorh
b <- eliminated$comuna
c <- eliminated$sexo
d <- eliminated$r3 #etnia
anio <- 2015
tpi <- "yoprcor"
}
if(xx==2017) {
eliminated <- casen2017
a <- eliminated$yoprcor#ytrabajocorh
b <- eliminated$comuna
c <- eliminated$sexo
d <- eliminated$r3 #etnia
anio <- 2017
tpi <- "yoprcor"
}
if(xx==2020) {
eliminated <- casen2020
a <- eliminated$yoprcor#ytrabajocorh
b <- eliminated$comuna
c <- eliminated$sexo
d <- eliminated$r3 #etnia
anio <- 2020
tpi <- "yoprcor"
}
promedios_grupales <-aggregate(a, by=list(b, c, d), FUN = mean , na.rm = TRUE)
promedios_grupales_sd <-aggregate(a, by=list(b, c, d), FUN = sd , na.rm = TRUE)
promedios_grupales_gini <-aggregate(a, by=list(b, c, d), FUN = gini , na.rm = TRUE)
promedios_grupales$sd = promedios_grupales_sd$sd.a
promedios_grupales$gini = promedios_grupales_gini$gini.a
df<-promedios_grupales
df$Año <- anio
df$tipo_ingreso <- tpi
tabla_matp <-xtabs(eliminated[,(expan)]~b+c+d, data = eliminated)
tabla_matp <- as.data.frame(tabla_matp)
tabla_matp <-tabla_matp[!(tabla_matp$Freq == 0),]
df$freq <- tabla_matp$Freq
df <- df[complete.cases(df), ]
names(df)[1] <- "Comuna"
names(df)[2] <- "Sexo"
names(df)[3] <- "Etnia"
names(df)[4] <- "Promedio del Ingreso"
names(df)[5] <- "Desviación standard"
names(df)[6] <- "Gini"
names(df)[7] <- "Año"
names(codigos_comunales)[1] <- "Código"
names(codigos_comunales)[2] <- "Comuna"
# codigos_comunales
df_tabla = merge( x = df, y = codigos_comunales, by = "Comuna", all.x = TRUE)
df <-df_tabla[!(df_tabla$Promedio == 0),]
tabla <<- df
}
for (n in 1:5){
funcion1(n)
assign(paste0("tabla","_",tanios),tabla)
}
tabla_cont_freq <- rbind(tabla_2011,tabla_2013,tabla_2015,tabla_2017,tabla_2020)
datatable(tabla_cont_freq, extensions = 'Buttons', escape = FALSE, rownames = FALSE,
options = list(dom = 'Bfrtip',
buttons = list('colvis', list(extend = 'collection',
buttons = list(
list(extend='csv',
filename = 'hitStats'),
list(extend='excel',
filename = 'hitStats'),
list(extend='pdf',
filename= 'hitStats')),
text = 'Download')), scrollX = TRUE))
unique(casen2006$CORTE)
tabla_matp <-xtabs(casen2006$EXPC~COMUNA+CORTE, data = casen2006)
head(tabla_matp,10)
s1 <- sum(tabla_matp[,1])+sum(tabla_matp[,2])+sum(tabla_matp[,3])
s2 <- sum(tabla_matp[,1])
s2*100/s1
casen_2006_r1 <- filter(casen2006, casen2006$R == "VIII")
# head(casen_2006_r1)
# casen_2006_r1 %>% filter(!is.na(CORTE))
tabla_matp <-xtabs(casen_2006_r1$EXPR~R+CORTE, data = casen_2006_r1)
# head(tabla_matp,10)
s1 <- sum(tabla_matp[,1])+sum(tabla_matp[,2])+sum(tabla_matp[,3])
s2 <- sum(tabla_matp[,3])
s2*100/s1
options(scipen=999)
casen2017_algarrobo <- filter(casen2017, casen2017$comuna == "Aysén")
casen2017_algarrobo_head <- casen2017_algarrobo
casen2017_algarrobo_head <- casen2017_algarrobo_head[,c("comuna","folio","ytot", "ytotcor","ytoth","yaimh","yaimcorh","ytotcorh")]
casen2017_algarrobo_head_sin_na <- mutate_at(casen2017_algarrobo_head, c("ytot", "ytotcor", "ytoth", "yaimh","yaimcorh","ytotcorh"), ~replace(., is.na(.), 0))
casen2017_algarrobo_head_sin_na$ytotcorh_sin_ah <- (casen2017_algarrobo_head_sin_na$ytotcorh - casen2017_algarrobo_head_sin_na$yaimcorh)
tabla <- table(casen2017_algarrobo_head_sin_na$folio)
tabla <- as.data.frame(tabla)
colnames(tabla) <- c("folio","freq_folio")
casen_fh <- casen2017_algarrobo_head_sin_na[,c("comuna","folio", "ytotcor","yaimcorh","ytotcorh","ytotcorh_sin_ah")]
casen_fh$folio <- as.character(casen_fh$folio)
repetidos2 <- merge(x=casen_fh, y=tabla, by = "folio", all.x = T)
rr <- repetidos2
datatable(rr, extensions = 'Buttons', escape = FALSE, rownames = FALSE,
options = list(dom = 'Bfrtip',
buttons = list('colvis', list(extend = 'collection',
buttons = list(
list(extend='copy'),
list(extend='excel',
filename = 'hitStats'),
list(extend='pdf',
filename= 'hitStats')),
text = 'Download')), scrollX = TRUE))
receptaculo <- data.frame()
comunas <- unique(casen2017$comuna)
for (j in comunas[1:10]) {
options(scipen=999)
casen2017_algarrobo <- filter(casen2017, casen2017$comuna == j)
casen2017_algarrobo_head <- casen2017_algarrobo
casen2017_algarrobo_head <- casen2017_algarrobo_head[,c("comuna","folio","ytotcor","yaimcorh","ytotcorh")]
casen2017_algarrobo_head_sin_na <- mutate_at(casen2017_algarrobo_head, c("ytotcor","yaimcorh","ytotcorh"), ~replace(., is.na(.), 0))
casen2017_algarrobo_head_sin_na$ytotcorh_sin_ah <- (casen2017_algarrobo_head_sin_na$ytotcorh - casen2017_algarrobo_head_sin_na$yaimcorh)
tabla <- table(casen2017_algarrobo_head_sin_na$folio)
tabla <- as.data.frame(tabla)
colnames(tabla) <- c("folio","freq_folio")
casen_fh <- casen2017_algarrobo_head_sin_na[,c("comuna","folio", "ytotcor","yaimcorh","ytotcorh","ytotcorh_sin_ah")]
casen_fh$folio <- as.character(casen_fh$folio)
repetidos2 <- merge(x=casen_fh, y=tabla, by = "folio", all.x = T)
rr <- repetidos2
calculos <- data.frame(
comuna = j,
prom_personas = mean(rr$ytotcor),
prom_hogares_sin_ing_imput = mean(rr$ytotcorh_sin_ah/rr$freq_folio),
prom_hogares = mean(rr$ytotcorh/rr$freq_folio)
)
receptaculo <- rbind(receptaculo,calculos)
}
datatable(receptaculo, extensions = 'Buttons', escape = FALSE, rownames = FALSE,
options = list(dom = 'Bfrtip',
buttons = list('colvis', list(extend = 'collection',
buttons = list(
list(extend='copy'),
list(extend='excel',
filename = 'hitStats'),
list(extend='pdf',
filename= 'hitStats')),
text = 'Download')), scrollX = TRUE))
# %>%
#   formatStyle('prom_hogares_sin_ing_imput', color = ifelse(receptaculo$prom_hogares_sin_ing_imput == receptaculo$prom_personas, 'red','blak'), backgroundColor = 'orange', fontWeight = 'bold' )
p <- plot_ly(receptaculo, width = 1200, x = ~comuna, y = ~prom_personas, name = 'Promedio de personas', mode = 'markers') %>% add_lines()
p <- p %>% add_lines(y = ~prom_hogares_sin_ing_imput, name = 'Promedio de hogares(sin Alquiler imputado)', mode = 'markers')
p
options(scipen=999)
casen2020_algarrobo <- filter(casen2020, casen2020$comuna == "Algarrobo")
# casen2020_algarrobo <- casen2017_algarrobo
casen2020_algarrobo <- casen2020_algarrobo[,c("comuna","folio","ytotcor","yaimcorh","ytotcorh","numper")]
casen2020_algarrobo
casen2020_algarrobo_head_sin_na <- mutate_at(casen2020_algarrobo, c("ytot", "ytotcor", "ytoth", "yaimh","yaimcorh","ytotcorh"), ~replace(., is.na(.), 0))
